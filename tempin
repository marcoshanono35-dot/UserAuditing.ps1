$acclist = @("jmoney", "plinktern") | ForEach-Object { $_.Trim().ToLower() }

# Get all AD users (enabled or disabled), convert names to lowercase
$acc = Get-ADUser -Filter * -Properties SamAccountName |
        Select-Object -ExpandProperty SamAccountName |
        ForEach-Object { $_.Trim().ToLower() }

foreach ($user in $acc) {
    if ($user -notin $acclist) {
        Disable-ADAccount -Identity $user
        Write-Host "Disabled AD account: $user"
    }
}


$builtins = @(
    "administrator",
    "guest",
    "krbtgt",
    "defaultaccount",
    "dgonzalez"
)

foreach ($user in $builtins) {
    try {
        $acct = Get-ADUser $user -Properties userAccountControl -ErrorAction Stop
        $uac = $acct.userAccountControl
        $newUac = $uac -band (-bnot 2)   # Clear the DISABLED flag

        Set-ADUser -Identity $user -Replace @{ userAccountControl = $newUac }
        Write-Host "Re-enabled: $user"
    }
    catch {
        Write-Host "Could not process $user: $_"
    }
}

